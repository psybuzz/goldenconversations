<!DOCTYPE html>
<html>
<head>
	<!--[if lt IE 9]>
	<script src="dist/html5shiv.js"></script>
	<![endif]-->
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no" />	
	<title>Meaningful.</title>
	<link href='http://fonts.googleapis.com/css?family=Lato:100,300,400,700|Merriweather:400,300italic,300,700,900' rel='stylesheet' type='text/css'>
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
	<script src="http://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.6.0/underscore-min.js"></script>
	<script src="http://cdnjs.cloudflare.com/ajax/libs/handlebars.js/1.3.0/handlebars.min.js"></script>
	<script src="/js/lib/jquery.leanModal.min.js"></script>

	<link rel="stylesheet" type="text/css" href="/stylesheets/main.css">
	<link rel="stylesheet" type="text/css" href="/stylesheets/messaging.css">
</head>
<body>
	<div class="wrapper">
		<div class="menu-bar">
			<a id="return-home" href="/home">< all conversations</a>
		</div>
		<h1 id="question">{{title}}</h1>
		<div id="participants">
			{{#each participants}}
				<span class='name'>{{firstName}} {{lastName}}</span>
			{{/each}}
		</div>

		<div class="display-fade"></div>
		<span>
			<h2 class="optionsTitle">Options</h2>
			<ul class="options">
				<li><a href="#new-input-modal" id="invite" rel="leanModal">Invite others</a></li>
				<li><a href=".choice-modal" id="archive" rel="leanModal">Archive conversation</a></li>
				<li><a href =".choice-modal" id="leave" rel="leanModal">Leave conversation</a></li>
				<li><a href =".choice-modal" id="delete" rel="leanModal">Delete conversation</a></li>
			</ul>
		</span>
		<div class="display">
			<div class="display-area"></div>
		</div>
		<div class="display-fade-bottom"></div>
		
		<div class="input-area">

			<form id='mainform' action="/post/create" method="POST">
				<textarea name="content" rows="4" cols="50" placeholder="Write down your thoughts"></textarea>
				<input type="submit" value="Send">
				<input type="hidden" value="{{user}}" name="username">
				<input type="hidden" value="{{userId}}" name="userId">
				<input type="hidden" value="{{conversationId}}" name="conversationId">
				<input type="hidden" value="{{csrfToken}}" name="_csrf">
			</form>
					

		</div>
	</div>
	<div id="new-input-modal">
		<div class="modal_close">x</div>
		<form>
			 <div class="txt-fld people-select">
				<input id="people_input" name="People" type="text" placeholder="Invite others">
			    <div id="search_names"></div>
			 </div>
			 <div class="btn-fld">
			 	<button type="submit">Add to conversation</button>
			 </div>
		</form>
	</div>
	<div class="choice-modal">
		<div class="modal_close">x</div>
		<form>
			 <div class="question"></div>
			<div class="btn-fld">
				<button class="yes">Yes</button>
				<button class="no">No</button>
		  </div>
		</form>
	</div>
	<script type='text/javascript'>
		// Set the question of the choice modal and attach the approriate 'action' data attribute
		// to the choice modal.
		function setAction (action){
			$('.choice-modal .question').html('Are you sure that you want to ' + action + ' this conversation?')
			$('.choice-modal').data('action', action);
		}

		$('#archive, #leave, #delete').click(function (){
			setAction($(this).attr('id'));
		});

		// Display the corresponding leanModal when one of the options is clicked.
		$("a[rel*=leanModal]").leanModal({
			top : 100,
			overlay : 0.5,
			closeButton: ".modal_close"
		});
	</script>
	<script type='text/javascript' src='/js/lib/jquery.min.js'></script>
	<script type='text/javascript' src='/js/lib/underscore.min.js'></script>
	<script type='text/javascript' src='/js/lib/backbone.min.js'></script>
	<script src="/socket.io/socket.io.js"></script>
	<script type='text/javascript' src='/js/Application.js'></script>

	<script type="text/javascript">
		function setScrollPos() {
			$(".display").animate({ scrollTop: $(".display-area").height()}, "fast"
			);
		}
		$(document).ready(function(){		
			function setFade() {
				$(".display-fade").css({
					left: $(".display-area").offset().left,
					width: $(".display-area").width()
				});

				$(".display-fade-bottom").css({
					left: $(".display-area").offset().left,
					width: $(".display-area").width()
				});
			}
			setScrollPos();
			setFade();

			$( window ).resize(function() {
				setScrollPos();
			 	setFade();
			});
					
		}); // ready
	</script>
	<script type="text/javascript">
		user = '{{user}}';
		userId = '{{userId}}';
		token = '{{csrfToken}}';
		conversationId = '{{conversationId}}';

		// for fun!
		// random colors to all, and to all, a good night.
		$('#participants').css({
			'margin': 'auto',
			'max-width': '750px'
		});
		$('#participants .name').each(function(i, span){
			$(span).css({
				'marginRight': '30px',
				'color': 'dimgray'
			});
			$(span)[0].innerHTML = "<div style='display:inline-block; margin-right: 5px; border-radius:100%; background-color: rgb("+Math.floor(Math.random()*255)+","+Math.floor(Math.random()*255)+","+Math.floor(Math.random()*255)+"); width: 20px; height: 20px'></div>" + $(span)[0].innerHTML;
		});
	</script>
</body>
</html>